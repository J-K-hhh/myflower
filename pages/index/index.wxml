<!--pages/index/index.wxml-->
<view class="container">
  <!-- 背景图片 -->
  <image class="bg-image" src="/images/index-bg.png" mode="aspectFill"></image>
  
  <!-- 如果列表为空，显示提示信息 -->
  <view wx:if="{{plantList.length === 0}}" class="empty-container">
    <view class="empty-icon">🌱</view>
    <view class="empty-text">您的阳台花园还在等第一株小绿植呢</view>
    <view class="empty-tip">点击下方的"+"按钮开始记录吧</view>
  </view>

  <!-- 绿植列表 -->
  <view wx:else class="plant-list {{plantList.length === 1 ? 'single-plant' : (plantList.length === 2 ? 'two-plants' : 'multiple-plants')}}">
    <!-- 动态状态图标 -->
    <view class="status-icon-container">
      <view class="status-icon">{{statusIcon}}</view>
      <view class="status-text">{{statusText}}</view>
    </view>
    
    <!-- 批量模式提示（固定在顶部） -->
    <view wx:if="{{batchMode}}" class="batch-mode-tip">
      <text class="batch-tip-text">批量模式：点击植物进行选择</text>
      <text class="batch-tip-count">已选择 {{selectedPlants.length}} 株</text>
    </view>
    <!-- 占位符，避免列表被顶部提示遮挡 -->
    <view wx:if="{{batchMode}}" class="batch-mode-tip-spacer"></view>
    
    <view class="plant-card {{batchMode ? 'batch-mode' : ''}} {{item.selected ? 'selected' : ''}}" 
          wx:for="{{plantList}}" wx:key="id" 
          data-id="{{item.id}}" 
          bindtap="{{batchMode ? 'togglePlantSelection' : 'goToDetail'}}">
      <!-- 批量选择框 -->
      <view wx:if="{{batchMode}}" class="batch-checkbox {{item.selected ? 'checked' : ''}}">
        <text class="checkbox-icon">{{item.selected ? '✓' : ''}}</text>
      </view>
      
      <image class="card-image" src="{{item.images[0]}}" mode="aspectFill"></image>
      <view class="card-content">
        <view class="card-title">{{item.aiResult.name || '未知植物'}}</view>
        <view class="card-info">
          <view class="info-item" wx:if="{{item.lastWateringDate}}">
            <text class="info-icon">💧</text>
            <text>{{item.lastWateringDate}}</text>
          </view>
          <view class="info-item" wx:if="{{item.lastFertilizingDate && !item.lastWateringDate}}">
            <text class="info-icon">🌱</text>
            <text>{{item.lastFertilizingDate}}</text>
          </view>
          <view class="info-item" wx:if="{{!item.lastWateringDate && !item.lastFertilizingDate}}">
            <text class="info-icon">📅</text>
            <text>{{item.createDate}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 添加按钮 -->
  <view class="add-button" bindtap="goToAdd" wx:if="{{!batchMode}}">
    <text class="add-icon">+</text>
  </view>

  <!-- 设置按钮 -->
  <view class="settings-button" bindtap="goToSettings" wx:if="{{!batchMode}}">
    <text class="settings-icon">⚙️</text>
  </view>
  
  <!-- 批量模式按钮 -->
  <view class="batch-mode-button" bindtap="toggleBatchMode" wx:if="{{!batchMode}}">
    <text class="batch-icon">📋</text>
  </view>
  
  <!-- 批量操作按钮组 -->
  <view wx:if="{{batchMode}}" class="batch-actions">
    <view class="batch-action-btn" bindtap="batchWatering">
      <text class="batch-action-icon">💧</text>
      <text class="batch-action-text">批量浇水</text>
    </view>
    <view class="batch-action-btn" bindtap="batchFertilizing">
      <text class="batch-action-icon">🌱</text>
      <text class="batch-action-text">批量施肥</text>
    </view>
    <view class="batch-action-btn cancel" bindtap="exitBatchMode">
      <text class="batch-action-icon">✕</text>
      <text class="batch-action-text">退出</text>
    </view>
  </view>
  
  <!-- 批量历史记录按钮 -->
  <view class="batch-history-button" bindtap="viewBatchHistory" wx:if="{{!batchMode}}">
    <text class="batch-history-icon">📋</text>
  </view>
  
  <!-- 批量操作历史弹窗 -->
  <view class="batch-history-modal" wx:if="{{showBatchHistoryModal}}" bindtap="closeBatchHistoryModal">
    <view class="batch-history-content" catchtap="stopPropagation">
      <view class="batch-history-header">
        <text class="batch-history-title">批量操作记录</text>
        <text class="close-btn" bindtap="closeBatchHistoryModal">✕</text>
      </view>
      <scroll-view class="batch-history-list" scroll-y="true">
        <view class="batch-history-item" wx:for="{{batchHistoryData}}" wx:key="timestamp">
          <view class="batch-history-info">
            <view class="batch-history-type">{{item.typeText}}</view>
            <view class="batch-history-time">{{item.date}} {{item.time}}</view>
          </view>
          <view class="batch-history-plants">
            <text class="batch-history-count">{{item.count}}株植物：</text>
            <text class="batch-history-plant-list">{{item.plantList}}</text>
          </view>
        </view>
        <view class="batch-history-empty" wx:if="{{batchHistoryData.length === 0}}">
          <text class="empty-icon">📋</text>
          <text class="empty-text">暂无批量操作记录</text>
        </view>
      </scroll-view>
    </view>
  </view>
</view>
