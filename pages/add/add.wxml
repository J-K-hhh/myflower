<!--pages/add/add.wxml-->
<view class="container">
  <!-- ËÉåÊôØÂõæÁâá -->
  <image class="bg-image" src="/images/add-bg.png" mode="aspectFill"></image>
  
  <form bindsubmit="formSubmit">
    <!-- 1. ÂõæÁâá‰∏ä‰º†Âå∫Âüü -->
    <view class="image-uploader" bindtap="chooseImage">
      <image wx:if="{{tempImagePath}}" class="preview-image" src="{{tempImagePath}}" mode="aspectFill"></image>
      <view wx:else class="uploader-placeholder">
        <text class="uploader-title">{{i18n.uploader.title}}</text>
        <text class="camera-icon">üå±</text>
        <text class="uploader-text">{{i18n.uploader.subtitle}}</text>
      </view>
    </view>

    <!-- Ê®°ÂûãÂíå‰ΩçÁΩÆ‰ø°ÊÅØ -->
    <view class="section" wx:if="{{tempImagePath}}">
      <view class="section-title">{{i18n.sections.recognitionInfo}}</view>
      <view class="info-card">
        <view class="info-item">
          <text class="info-label">{{i18n.info.currentModel}}</text>
          <text class="info-value">{{selectedModel === 'baidu' ? i18n.info.modelBaidu : i18n.info.modelQwen}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">{{i18n.info.locationService}}</text>
          <text class="info-value">{{locationEnabled ? i18n.info.locationEnabled : i18n.info.locationDisabled}}</text>
        </view>
        <view class="info-item" wx:if="{{currentLocation}}">
          <text class="info-label">{{i18n.info.currentLocation}}</text>
          <text class="info-value">{{currentLocation.latitude}}, {{currentLocation.longitude}}</text>
        </view>
      </view>
    </view>

    <!-- ÁÖßÁâáÊó•ÊúüÔºàÂèØÁºñËæëÔºâ -->
    <view class="section" wx:if="{{tempImagePath}}">
      <view class="section-title">{{i18n.sections.photoInfo}}</view>
      <view class="form-group">
        <view class="form-item">
          <text class="item-label">
            <text class="label-icon">üìÖ</text>
            {{i18n.form.photoDate}}
          </text>
          <picker mode="date" value="{{photoDate}}" bindchange="bindPhotoDateChange">
            <view class="picker {{photoDate ? '' : 'picker-empty'}}">
              <text class="picker-icon">üìÜ</text>
              {{photoDate || i18n.form.selectDate}}
            </view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 2. AI ËØÜÂà´ÁªìÊûúÂ±ïÁ§∫ -->
    <view class="section" wx:if="{{isLoading}}">
      <view class="loading-container">
        <custom-loading text="{{i18n.loading.recognizing}}"></custom-loading>
      </view>
    </view>

    <view class="section" wx:if="{{aiResult.name}}">
      <view class="section-title">{{i18n.sections.recognitionResult}}</view>
      <view class="ai-result-card">
        <view class="plant-name">{{aiResult.name}}</view>
        <view class="plant-scientific" wx:if="{{aiResult.scientificName}}">{{aiResult.scientificName}}</view>
        <view class="plant-baike" wx:if="{{aiResult.baike && aiResult.baike.description}}">{{aiResult.baike.description}}</view>
        
        <!-- ÈÄö‰πâÂçÉÈóÆVLÁöÑËØ¶ÁªÜÁªìÊûú -->
        <view class="qwen-result" wx:if="{{aiResult.model === 'qwen-vl'}}">
          <view class="qwen-section" wx:if="{{aiResult.wateringTips}}">
            <view class="qwen-title">{{i18n.qwen.watering}}</view>
            <view class="qwen-content">{{aiResult.wateringTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.lightingTips}}">
            <view class="qwen-title">{{i18n.qwen.lighting}}</view>
            <view class="qwen-content">{{aiResult.lightingTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.healthInfo}}">
            <view class="qwen-title">{{i18n.qwen.health}}</view>
            <view class="qwen-content">{{aiResult.healthInfo}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.careTips}}">
            <view class="qwen-title">{{i18n.qwen.care}}</view>
            <view class="qwen-content">{{aiResult.careTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.funFacts}}">
            <view class="qwen-title">{{i18n.qwen.knowledge}}</view>
            <view class="qwen-content">{{aiResult.funFacts}}</view>
          </view>
        </view>
        
        <!-- ÁôæÂ∫¶AIÁöÑÂÖªÊä§Ë¶ÅÁÇπ -->
        <view class="care-tips" wx:if="{{aiResult.careTips && aiResult.model !== 'qwen-vl'}}">
          <view class="tips-title">{{i18n.baiduCare.title}}</view>
          <view class="tip-item" wx:if="{{aiResult.careTips.watering}}">
            <text class="tip-icon">üíß</text>
            <text class="tip-text">{{aiResult.careTips.watering}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.lighting}}">
            <text class="tip-icon">‚òÄÔ∏è</text>
            <text class="tip-text">{{aiResult.careTips.lighting}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.temperature}}">
            <text class="tip-icon">üå°Ô∏è</text>
            <text class="tip-text">{{aiResult.careTips.temperature}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.humidity}}">
            <text class="tip-icon">üí®</text>
            <text class="tip-text">{{aiResult.careTips.humidity}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.fertilizing}}">
            <text class="tip-icon">üå±</text>
            <text class="tip-text">{{aiResult.careTips.fertilizing}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 3. Ë°®ÂçïËæìÂÖ•È°π -->
    <view class="section">
      <view class="section-title">{{i18n.sections.careInfo}}</view>
      <view class="form-group">
        <view class="form-item">
          <text class="item-label">
            <text class="label-icon">üíß</text>
            {{i18n.form.lastWatering}}
          </text>
          <picker mode="date" value="{{wateringDate}}" bindchange="bindWateringDateChange">
            <view class="picker {{wateringDate ? '' : 'picker-empty'}}">
              <text class="picker-icon">üìÖ</text>
              {{wateringDate || i18n.form.selectDate}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="item-label">
            <text class="label-icon">üå±</text>
            {{i18n.form.lastFertilizing}}
          </text>
          <picker mode="date" value="{{fertilizingDate}}" bindchange="bindFertilizingDateChange">
            <view class="picker {{fertilizingDate ? '' : 'picker-empty'}}">
              <text class="picker-icon">üìÖ</text>
              {{fertilizingDate || i18n.form.selectDate}}
            </view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 4. Êèê‰∫§ÊåâÈíÆ -->
    <button class="save-button" form-type="submit" type="primary" disabled="{{!tempImagePath || isLoading}}">
      {{isLoading ? i18n.buttons.recognizing : i18n.buttons.save}}
    </button>
  </form>
</view>
