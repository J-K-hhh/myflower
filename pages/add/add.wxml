<!--pages/add/add.wxml-->
<view class="container">
  <!-- èƒŒæ™¯å›¾ç‰‡ -->
  <image class="bg-image" src="/images/add-bg.png" mode="aspectFill"></image>
  
  <form bindsubmit="formSubmit">
    <!-- 1. å›¾ç‰‡ä¸Šä¼ åŒºåŸŸ -->
    <view class="image-uploader" bindtap="chooseImage">
      <image wx:if="{{tempImagePath}}" class="preview-image" src="{{tempImagePath}}" mode="aspectFill"></image>
      <view wx:else class="uploader-placeholder">
        <text class="uploader-title">æ·»åŠ æ–°ç»¿æ¤</text>
        <text class="camera-icon">ğŸŒ±</text>
        <text class="uploader-text">ä¸ºæ‚¨çš„ç»¿æ¤æ‹ä¸€å¼ ç¾ç…§å§ ğŸ“·</text>
      </view>
    </view>

    <!-- æ¨¡å‹å’Œä½ç½®ä¿¡æ¯ -->
    <view class="section" wx:if="{{tempImagePath}}">
      <view class="section-title">è¯†åˆ«ä¿¡æ¯</view>
      <view class="info-card">
        <view class="info-item">
          <text class="info-label">å½“å‰æ¨¡å‹ï¼š</text>
          <text class="info-value">{{selectedModel === 'baidu' ? 'ç™¾åº¦AIæ¤ç‰©è¯†åˆ«' : 'é€šä¹‰åƒé—®VL'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ä½ç½®æœåŠ¡ï¼š</text>
          <text class="info-value">{{locationEnabled ? 'å·²å¼€å¯' : 'æœªå¼€å¯'}}</text>
        </view>
        <view class="info-item" wx:if="{{currentLocation}}">
          <text class="info-label">å½“å‰ä½ç½®ï¼š</text>
          <text class="info-value">{{currentLocation.latitude}}, {{currentLocation.longitude}}</text>
        </view>
      </view>
    </view>

    <!-- 2. AI è¯†åˆ«ç»“æœå±•ç¤º -->
    <view class="section" wx:if="{{isLoading}}">
      <view class="loading-container">
        <custom-loading text="æ­£åœ¨è¯†åˆ«ä¸­..."></custom-loading>
      </view>
    </view>

    <view class="section" wx:if="{{aiResult.name}}">
      <view class="section-title">è¯†åˆ«ç»“æœ</view>
      <view class="ai-result-card">
        <view class="plant-name">{{aiResult.name}}</view>
        <view class="plant-scientific" wx:if="{{aiResult.scientificName}}">{{aiResult.scientificName}}</view>
        <view class="plant-baike" wx:if="{{aiResult.baike && aiResult.baike.description}}">{{aiResult.baike.description}}</view>
        
        <!-- é€šä¹‰åƒé—®VLçš„è¯¦ç»†ç»“æœ -->
        <view class="qwen-result" wx:if="{{aiResult.model === 'qwen-vl'}}">
          <view class="qwen-section" wx:if="{{aiResult.wateringTips}}">
            <view class="qwen-title">ğŸ’§ æµ‡æ°´tips</view>
            <view class="qwen-content">{{aiResult.wateringTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.lightingTips}}">
            <view class="qwen-title">â˜€ï¸ å…‰ç…§tips</view>
            <view class="qwen-content">{{aiResult.lightingTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.healthInfo}}">
            <view class="qwen-title">ğŸ¥ å¥åº·ä¿¡æ¯</view>
            <view class="qwen-content">{{aiResult.healthInfo}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.careTips}}">
            <view class="qwen-title">ğŸŒ± ç»¼åˆå…»æŠ¤tips</view>
            <view class="qwen-content">{{aiResult.careTips}}</view>
          </view>
          <view class="qwen-section" wx:if="{{aiResult.funFacts}}">
            <view class="qwen-title">ğŸ’¡ å°çŸ¥è¯†</view>
            <view class="qwen-content">{{aiResult.funFacts}}</view>
          </view>
        </view>
        
        <!-- ç™¾åº¦AIçš„å…»æŠ¤è¦ç‚¹ -->
        <view class="care-tips" wx:if="{{aiResult.careTips && aiResult.model !== 'qwen-vl'}}">
          <view class="tips-title">å…»æŠ¤è¦ç‚¹</view>
          <view class="tip-item" wx:if="{{aiResult.careTips.watering}}">
            <text class="tip-icon">ğŸ’§</text>
            <text class="tip-text">{{aiResult.careTips.watering}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.lighting}}">
            <text class="tip-icon">â˜€ï¸</text>
            <text class="tip-text">{{aiResult.careTips.lighting}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.temperature}}">
            <text class="tip-icon">ğŸŒ¡ï¸</text>
            <text class="tip-text">{{aiResult.careTips.temperature}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.humidity}}">
            <text class="tip-icon">ğŸ’¨</text>
            <text class="tip-text">{{aiResult.careTips.humidity}}</text>
          </view>
          <view class="tip-item" wx:if="{{aiResult.careTips.fertilizing}}">
            <text class="tip-icon">ğŸŒ±</text>
            <text class="tip-text">{{aiResult.careTips.fertilizing}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- 3. è¡¨å•è¾“å…¥é¡¹ -->
    <view class="section">
      <view class="section-title">å…»æŠ¤ä¿¡æ¯</view>
      <view class="form-group">
        <view class="form-item">
          <text class="item-label">
            <text class="label-icon">ğŸ’§</text>
            ä¸Šæ¬¡æµ‡æ°´
          </text>
          <picker mode="date" value="{{wateringDate}}" bindchange="bindWateringDateChange">
            <view class="picker {{wateringDate ? '' : 'picker-empty'}}">
              <text class="picker-icon">ğŸ“…</text>
              {{wateringDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
            </view>
          </picker>
        </view>
        <view class="form-item">
          <text class="item-label">
            <text class="label-icon">ğŸŒ±</text>
            ä¸Šæ¬¡æ–½è‚¥
          </text>
          <picker mode="date" value="{{fertilizingDate}}" bindchange="bindFertilizingDateChange">
            <view class="picker {{fertilizingDate ? '' : 'picker-empty'}}">
              <text class="picker-icon">ğŸ“…</text>
              {{fertilizingDate || 'è¯·é€‰æ‹©æ—¥æœŸ'}}
            </view>
          </picker>
        </view>
      </view>
    </view>

    <!-- 4. æäº¤æŒ‰é’® -->
    <button class="save-button" form-type="submit" type="primary" disabled="{{!tempImagePath || isLoading}}">
      {{isLoading ? 'è¯†åˆ«ä¸­...' : 'ğŸŒ± ç§ä¸‹ç»¿æ¤'}}
    </button>
  </form>
</view>
