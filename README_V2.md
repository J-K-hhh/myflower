# 我的阳台花园 - 版本说明与功能指南

## 项目概述
我的阳台花园是一款微信小程序，面向阳台/室内植物的日常养护与记录。支持添加植物、记录浇水/施肥，基于多模态模型进行植物识别与健康分析，并提供便捷的图片与批量操作管理能力。

## 版本历史

### V0.1 - 基础功能 (09/14)
- ✅ 状态：已上线
- 功能：植物添加、浇水/施肥记录等基础管理能力
- 说明：首个可用版本，打通核心记录流程

### V0.2 - 模型管理功能 (09/14)
- ✅ 状态：开发完成
- 功能：新增多模态模型接入与切换
- 亮点：
  - 新增设置页，可选择识别模型
  - 支持百度AI植物识别与通义千问 Qwen-VL（qwen-vl-max）
  - 支持测试模型连接状态
  - 基于地理位置提供更个性化的养护建议

### V0.3 - 功能加强（已发布）
- ✅ 状态：已上线
- 功能：批量操作、图片管理与体验优化
- 亮点：
  1. 批量浇水
  2. 批量施肥
  3. 图片信息展示（拍摄日期、备忘）
  4. 图片顺序管理（上移/下移）
  5. 批量操作历史记录
  6. 交互优化（确认、进度、错误提示）

### V0.4 - 分享功能（M1 已落地部分）
- ✅ 状态：M1 最小可用闭环已完成
- 功能：新增「转发落地页」与首页「朋友分享区」
- 亮点：
  1. 转发卡片直达「转发落地页」（Share Landing）
  2. 展示首图大卡 + 最新状态条 + 轻互动（点赞/评论，本地存储）
  3. 一键「关注到我的首页」→ 首页出现「朋友分享区」（横滑）
  4. 首页自动刷新朋友分享的最新状态（云函数读取好友植物，M1 无需新后端模型）

## 当前版本功能详情

### 模型管理功能
- 设置页面选择识别模型（百度AI / Qwen-VL）
- 一键测试模型连接状态

### 通义千问 Qwen-VL 集成
- 集成 qwen-vl-max 多模态模型
- 提供更丰富的植物识别与养护建议
- 支持结合地理位置进行个性化提示
- 输出信息包含：
  - 植物名称与学名
  - 浇水建议
  - 光照建议
  - 健康状态分析
  - 综合养护建议
  - 趣味知识

### 健康分析
- 使用 Qwen-VL 对植物健康进行分析
- 在拍照行为触发时自动进行（选择 Qwen-VL 时）
- 保存并支持查看历史健康分析记录

### 存储限制管理
- 可设置每株植物的照片数量上限
- 可设置浇水/施肥记录的数量上限
- 超出上限时自动清理较早记录

### 位置服务
- 支持获取用户地理位置（需授权）
- 结合位置信息提供更准确的养护建议

## 技术实现

### 新增文件
- `pages/settings/` - 设置页面
- `utils/model_utils.js` - 模型管理工具方法

### 主要功能点
1. 模型切换：在设置中选择百度AI或 Qwen-VL
2. 智能识别：按所选模型进行植物识别
3. 健康分析：基于 Qwen-VL 输出健康诊断
4. 存储管理：自动执行照片/记录数量限制
5. 位置服务：使用地理位置进行个性化建议

## 配置与安全
- 百度AI：沿用既有项目配置
- Qwen-VL：请以安全方式配置 API Key（切勿明文硬编码在客户端）
  - 推荐：使用云函数/服务端环境变量或安全配置服务
  - 示例占位：`QWEN_VL_API_KEY=your-key`（在安全运行环境中设置）

## V0.3 功能详情

### 批量操作
- 批量浇水：多选植物，一次性更新浇水记录
- 批量施肥：多选植物，一次性更新施肥记录
- 批量模式：点击批量模式按钮进入多选
- 操作历史：记录时间、植物列表与操作类型

### 图片管理增强
- 拍摄日期：在植物详情页的图片上展示
- 备忘信息：为每张图片新增/编辑简短备忘
- 图片排序：通过上/下箭头调整顺序
- 图片信息：包含路径、时间戳、日期与备忘

### 用户体验优化
- 操作确认：批量操作前弹出确认，避免误触
- 进度提示：长耗时操作显示加载与进度
- 错误处理：清晰的错误提示与边界处理
- 批量历史：查看以往批量操作记录（时间与植物列表）

## V0.4 分享功能详情

### 植物分享
- 分享到微信好友：选择植物后可直接分享给微信好友
- 分享到朋友圈：生成美观的分享卡片，包含植物关键信息
- 分享内容包含：
  - 植物照片（题图）
  - 植物名称与学名
  - 养护记录统计（浇水/施肥次数）
  - 健康分析结果（如使用Qwen-VL）
  - 养护建议与趣味知识
- 分享卡片设计：美观的卡片布局，突出植物特色

## 使用方法

### 基础功能（V0.1~V0.2）
1. 打开设置页选择识别模型
2. 视情况开启位置服务（可选）
3. 配置存储限制（照片与记录上限）
4. 添加植物时选择照片，系统将基于所选模型进行识别
5. 在详情页拍照时，如选择 Qwen-VL 将自动进行健康分析
6. 在历史记录中查看过往健康分析

### V0.3 新功能
1）批量操作
   - 首页左下角点击批量模式（📋）
   - 选择需要操作的植物（出现选择框）
   - 点击底部批量浇水或批量施肥
   - 确认后等待完成

2）图片管理
   - 详情页的图片展示拍摄日期
   - 点击“添加备忘”或现有备忘进行编辑
   - 使用左上角箭头调整图片顺序
   - 通过右上角菜单设置题图或删除

3）批量历史
   - 首页右下角点击批量历史（📋）
   - 查看每次批量操作的时间、植物列表与操作类型

### V0.4 新功能（M1）
1）转发落地页（Share Landing）
   - 入口：微信转发卡片 → 打开小程序路径 `pages/share/landing?owner=<openid>&pid=<plantId>&from=wxcard&scene=forward`
   - 信息：首图大卡、最新状态条（最近浇水/施肥/体检）、备忘摘要（取最近图片的 `memo`）
   - 互动：点赞、评论（均为本地存储，便于演示与试用）
   - 关注：一键「关注到我的首页」

2）首页 - 朋友分享区（横滑）
   - 展示：最近 14 天内关注的最多 10 个分享卡片
   - 内容：缩略图、植物名、分享者昵称、最新状态标签
   - 操作：快速跳转到对应的转发落地页，进行留言/互动

3）转发路径与卡片规范
   - 标题：`{分享者}的{植物名}`（示例：`Jeff 的花烛`）
   - 路径：`/pages/share/landing?owner=<openid>&pid=<plantId>&from=wxcard&scene=forward`
   - 封面：使用首图（必要时转为临时 URL）

## 注意事项
1. Qwen-VL 功能依赖网络连接
2. 开启位置服务需用户授权
3. 修改存储限制可能影响现有数据（超限项将被清理）
4. 健康分析仅在选择 Qwen-VL 模型时启用
5. V0.3 相关功能已全部实现并发布
6. 批量操作将同时更新所选植物的记录
7. 图片备忘建议不超过 100 个字符
8. 批量操作历史最多保留 50 条记录
9. V0.4 分享功能（M1）需要微信环境支持
10. 分享卡片会自动适配不同屏幕尺寸
11. 分享内容基于当前植物数据生成；M1 的评论与点赞为本地存储（演示用途）

## 使用说明（M1 转发闭环）

- 在「详情页」点击转发（分享到好友/朋友圈）。
- 接收者打开「转发落地页」，可浏览大图、最新状态，进行点赞/评论。
- 点击「关注到我的首页」，回到首页即可看到「朋友分享区」卡片。
- 首页会在进入时尝试刷新这些卡片的“最新状态”。
